<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>NeurAloud</title>
<link href="style.css" rel="stylesheet"/>
<meta content="ğŸ’ªğŸ“šğŸ§ = Empowering minds through books and sound" name="description"/>
<link href="manifest.json" rel="manifest"/>
<link href="favicon.ico" rel="icon" type="image/x-icon"/>
<!-- âœ… Load ResponsiveVoice first (required for detection to work) -->
<script src="https://code.responsivevoice.org/responsivevoice.js"></script>
<!-- <script src="https://code.responsivevoice.org/responsivevoice.js?key=YOUR_KEY_HERE"></script>   not using a paid key yet -->
</head>
<body>
<header>
<div class="logo-container">
<img alt="NeurAloud Logo" class="app-logo" src="NeurAloudlogo.png"/>
<span class="logo-title">NeurAloud</span>
</div>
<nav>
<button onclick="navigate('home')" title="Home">ğŸ </button>
<button onclick="navigate('library')">Library</button>
<button onclick="navigate('listen')">Listen</button>
<button onclick="navigate('capture')">Capture</button>
<button onclick="navigate('store')">Store</button>
<button onclick="navigate('profile')" title="Settings">âš™ï¸</button>
</nav>
</header>
<main>
<!-- Home Section -->
<section class="active-section" id="home">
<div class="quad-container">
<div class="quad-card">
<h3>ğŸ“š Upload a Document</h3>
<p>Bring your own files (PDF, EPUB, DOCX, etc.)</p>
<button onclick="navigate('upload')">Upload Now</button>
</div>
<div class="quad-card">
<h3>ğŸ”Š Listen Instantly</h3>
<p>Start reading any document with your favorite voice</p>
<button onclick="navigate('listen')">Start Listening</button>
</div>
<div class="quad-card">
<h3>ğŸŒ Live Capture</h3>
<p>Listen to websites, articles, or your environment</p>
<button onclick="navigate('capture')">Capture Audio</button>
</div>
<div class="quad-card">
<h3>ğŸ›ï¸ Explore Store</h3>
<p>Find premium voices, avatars &amp; add-ons</p>
<button onclick="navigate('store')">Visit Store</button>
</div>
</div>
<div class="reward-container">
<h2>ğŸ† Your Rewards</h2>
<div class="rewards">
<div class="reward-card">
<h4>5-day Streak</h4>
<p>You've earned 50 XP</p>
</div>
<div class="reward-card">
<h4>Top Listener</h4>
<p>3 hours this week</p>
</div>
<div class="reward-card">
<h4>Explorer</h4>
<p>Tried 4 new voices</p>
</div>
</div>
</div>
<div class="continue-listening">
<h3>â¯ï¸ Continue Listening</h3>
<div class="horizontal-scroll" id="continue-slider">
<div class="doc-card">
<p>ğŸ“„ Book1.pdf</p>
<button onclick="loadFromLibrary('Book1.pdf')">Resume</button>
</div>
<div class="doc-card">
<p>ğŸ“„ Research.epub</p>
<button onclick="loadFromLibrary('Research.epub')">Resume</button>
</div>
</div>
</div>
<div class="recently-played">
<h3>ğŸ§ Recently Played</h3>
<ul id="recent-files">
<li>Book1.pdf - 3m ago</li>
<li>Article2.txt - 12m ago</li>
<li>Speech.mp3 - 2h ago</li>
</ul>
</div>
<div class="recommended-section">
<h3>ğŸŒŸ Recommended for You</h3>
<ul id="recommend-list">
<li>ğŸ§  "7 Habits of Highly Effective People"</li>
<li>ğŸ“˜ "Deep Work" by Cal Newport</li>
<li>ğŸ™ï¸ "Neural Narratives" - Podcast Series</li>
</ul>
</div>
<div class="achievement-section">
<h3>ğŸ… Achievements</h3>
<ul id="achievement-list">
<li>ğŸ“… 7-Day Streak Badge</li>
<li>ğŸ—£ï¸ 1000 Minutes Listened</li>
<li>ğŸ“š 10 Books Completed</li>
</ul>
</div>
</section>
<!-- ğŸ“š Library Section -->
<section class="section" id="library">
<h2>ğŸ“š Your Library</h2>
<div class="library-flex-container">
<!-- ğŸ“‚ LEFT SIDE (60%): Playlist + Listen Library -->
<div class="library-left">
<!-- ğŸµ Playlist (Top Left) -->
<div class="library-subsection">
<h3>ğŸµ Playback Queue</h3>
<div class="horizontal-scroll" id="playback-queue">
<!-- Playlist items dynamically inserted -->
</div>
<button id="play-all">â–¶ï¸ Play Playlist</button>
<button id="export-txt">â¬‡ï¸ Export as TXT</button>
<button id="export-json">â¬‡ï¸ Export as JSON</button>
</div>
<div id="favorites-section">
<h3>â­ Favorites</h3>
<ul id="favorites-list"></ul>
</div>
<!-- ğŸ—‚ï¸ Listen Library -->
<div class="library-subsection">
<h3>ğŸ—‚ï¸ Listen Documents</h3>
<div class="grid-library" id="listen-library">
<!-- Listen items dynamically inserted -->
</div>
</div>
<!-- ğŸ“¤ Upload Multiple -->
<div class="library-subsection">
<h3>ğŸ“¤ Upload Multiple</h3>
<label class="custom-upload-button" for="file-input">
                              ğŸ“ Select &amp; Upload Files
                         </label>
<input accept=".pdf,.epub,.txt,.docx,.doc,.pptx,.csv,.rtf,.msg,.sql,.webp,.xls,.xlsx,.xlsm,.xltx,.xltm,.tif,.eps,.tmp" id="file-input" multiple="" style="display:none;" type="file"/>
</div>
<div class="library-subsection">
<h3>ğŸ“ Listen Documents</h3>
<div class="library-list" id="listen-library"></div>
<button class="danger-btn" id="bulk-delete-listen-btn">ğŸ—‘ï¸ Delete Selected</button>
</div>
</div>
<!-- ğŸ§± VISUAL DIVIDER -->
<div class="library-divider"></div>
<!-- ğŸ™ï¸ RIGHT SIDE (40%): Captures -->
<div class="library-right">
<div class="library-subsection">
<h3>ğŸ™ï¸ Capture Texts</h3>
<div class="grid-library" id="capture-library">
<!-- Capture items dynamically inserted -->
</div>
</div>
<!-- âš™ï¸ Toggle for Capture Overwrite -->
<div class="context-toggle" id="capture-toggle-container">
<label>
<input checked="" id="overwrite-capture-toggle" type="checkbox"/>
                        Auto Overwrite on Capture Play
                      </label>
</div>
<!-- ğŸ’¾ Save Captured Items -->
<div class="library-subsection">
<h3>ğŸ’¾ Save Captured</h3>
<button id="save-captured-btn">âœ… Save Selected</button>
</div>
<div class="library-subsection">
<h3>ğŸ™ï¸ Captured Texts</h3>
<div class="library-list" id="capture-library"></div>
<button class="danger-btn" id="bulk-delete-capture-btn">ğŸ—‘ï¸ Delete Selected</button>
</div>
</div>
</div>
<!-- ğŸ—‘ï¸ Clear & Manage All Controls -->
<div class="library-controls">
<button onclick="confirmClearLibrary()">ğŸ—‘ï¸ Clear Entire Library</button>
<button onclick="confirmClearFavorites()">âŒ Remove All Favorites</button>
<button onclick="confirmClearPlaylist()">ğŸš« Clear Playlist</button>
</div>
</section>
<!-- Listen Section -->
<section class="section" id="listen">
<h2>ğŸ”Š Listen</h2>
<!-- ğŸ› TTS Engine and Voice Dropdowns -->
<div class="tts-controls-listen">
  <label for="tts-engine-listen">ğŸ§  TTS Engine:</label>
  <select id="tts-engine-listen">
    <option value="local">Local</option>
    <option value="ibm">IBM</option>
    <option value="responsiveVoice">ResponsiveVoice</option>
    <option value="google">Google</option>
  </select>

  <!-- âœ… Google usage bar -->
  <div id="google-tts-usage" class="usage-bar"></div>

  <label for="voice-listen">ğŸ¤ Voice:</label>
  <select id="voice-listen"></select>
  <select id="language-select-listen"></select>
  <input id="tts-input-listen" placeholder="Type text to speak..." type="text"/>
  <button id="speak-btn-listen">Speak</button>
</div>
<!-- ğŸš Playback Buttons -->
<div class="playback-controls">
<button id="play-btn">â–¶ï¸ Play</button>
<button id="pause-btn">â¸ Pause</button>
<button id="stop-btn">â¹ Stop</button>
<button id="loop-btn">ğŸ” Loop</button>
</div>
<!-- ğŸ§ Save + Speed + Pitch -->
<div class="save-controls">
<!-- <button id="save-to-library">ğŸ’¾ Save to Library</button>-->
<button id="save-to-library-btn">ğŸ’¾ Save to Library</button>
<label for="rate-slider">âš¡ Speed:</label>
<input id="rate-slider" max="2" min="0.5" step="0.01" type="range"/>
<span id="rate-value">1.00</span>
<label for="pitch-slider">ğŸš Pitch:</label>
<input id="pitch-slider" max="2" min="0.5" step="0.01" type="range"/>
<span id="pitch-value">1.00</span>
</div>
<!-- ğŸ“š Document Display Area -->
<div class="text-display theme-background" id="text-display"></div>
<!-- ğŸµ Playlist Panel -->
<div id="playback-queue-container">
<h3>ğŸ“ Playback Queue</h3>
<ul id="playback-queue"></ul>
<button id="play-all">â–¶ï¸ Play All</button>
<button id="export-txt">ğŸ“„ Export TXT</button>
<button id="export-json">ğŸ§¾ Export JSON</button>
</div>
<!-- ğŸ“¥ Upload New Document -->
<div class="upload-area">
<label class="file-label" for="file-input">ğŸ“¤ Choose File</label>
<input accept=".pdf,.epub,.txt,.docx,.doc,.pptx,.csv,.rtf,.msg,.sql,.webp,.xls,.xlsx,.xlsm,.xltx,.xltm,.tif,.eps,.tmp" id="file-input" type="file"/>
</div>
<!-- ğŸ’¬ Sentence Navigation -->
<div class="sentence-nav">
<button id="prev-sentence">â® Prev</button>
<button id="next-sentence">â­ Next</button>
</div>
</section>
<!-- Capture Section -->
<section class="section" id="capture">
<h2>ğŸŒ Live Capture</h2>
<!-- ğŸ› TTS Engine and Voice Selection -->
<div class="tts-controls-capture">
  <label for="tts-engine-capture">ğŸ§  TTS Engine:</label>
  <select id="tts-engine-capture">
    <option value="local">Local</option>
    <option value="ibm">IBM</option>
    <option value="responsiveVoice">ResponsiveVoice</option>
    <option value="google">Google</option>
  </select>

  <!-- âœ… Add usage bar here -->
  <div id="google-tts-usage" class="usage-bar"></div>

  <label for="voice-capture">ğŸ¤ Voice:</label>
  <select id="voice-capture"></select>
  <select id="language-select-capture"></select>
  <input id="tts-input-capture" placeholder="Type text to speak..." type="text"/>
  <button id="speak-btn-capture">Speak</button>
</div>

<!-- ğŸš Playback Controls -->
<div class="playback-controls">
<button id="play-capture-btn">â–¶ï¸ Play</button>
<button id="pause-capture-btn">â¸ Pause</button>
<button id="stop-capture-btn">â¹ Stop</button>
<button id="loop-capture-btn">ğŸ” Loop</button>
</div>
<!-- ğŸ’¾ Save & Sliders -->
<div class="save-controls">
<button id="save-capture">ğŸ’¾ Save to Library</button>
<label for="rate-capture-slider">âš¡ Speed:</label>
<input id="rate-capture-slider" max="2" min="0.5" step="0.01" type="range"/>
<span id="rate-capture-value">1.00</span>
<label for="pitch-capture-slider">ğŸš Pitch:</label>
<input id="pitch-capture-slider" max="2" min="0.5" step="0.01" type="range"/>
<span id="pitch-capture-value">1.00</span>
</div>
<!-- ğŸ™ï¸ Captured Text Area -->
<div class="text-display theme-background" id="capture-display"></div>
<!-- ğŸ§ Capture Metadata -->
<div class="capture-controls">
<label for="capture-language">ğŸŒ Capture Language:</label>
<select id="capture-language">
<option value="auto">Auto Detect</option>
<option value="en">English</option>
<option value="fr">French</option>
<option value="es">Spanish</option>
<option value="pt">Portuguese</option>
<option value="zh">Chinese</option>
<option value="ar">Arabic</option>
<!-- Add more as needed -->
</select>
<label for="read-language">ğŸ—£ï¸ Read Language:</label>
<select id="read-language">
<option value="en">English</option>
<option value="fr">French</option>
<option value="es">Spanish</option>
<option value="pt">Portuguese</option>
<option value="zh">Chinese</option>
<option value="ar">Arabic</option>
<!-- Add more as needed -->
</select>
<label>
<input id="capture-translate" type="checkbox"/> Translate Before Reading
               </label>
</div>
<!-- ğŸ¤ Capture Activation -->
<div class="capture-actions">
<button id="start-capture">ğŸ¤ Start Listening</button>
<button id="stop-capture">ğŸ›‘ Stop Listening</button>
<p id="capture-status">ğŸ”ˆ Status: Idle</p>
</div>
</section>
<!-- Store Section -->
<section class="section" id="store">
<h2>ğŸ›ï¸ NeurAloud Store</h2>
<p>Coming soon: premium voices, languages, and tools!</p>
</section>
<!-- Settings Section -->
<section class="section" id="profile">
<h2>âš™ï¸ Settings</h2>
<!-- ğŸ¨ Theme Selector -->
<div class="settings-group">
<label for="theme-select">ğŸ¨ Theme:</label>
<select id="theme-select">
<option value="light">Light Mode</option>
<option value="dark">Dark Mode</option>
<option value="blue">Blue Mode</option>
<option value="royal">Royal Mode</option>
<option value="gray">Gray Mode</option>
</select>
<button onclick="toggleMode()">ğŸŒ“ Toggle Mode</button>
</div>
<h2>âš™ï¸ Profile Settings</h2>
<div id="profile-settings">
<!-- Elements will be auto-created and inserted here -->
</div>
<!-- ğŸ—£ï¸ Voice Avatar Selection -->
<div class="settings-group">
<label for="voice-avatar">ğŸ—£ï¸ Voice Avatar:</label>
<select id="voice-avatar">
<option value="default">Default</option>
<option value="warm-male">Warm Male</option>
<option value="bright-female">Bright Female</option>
<option value="robotic-ai">Robotic AI</option>
<option value="calm-deep">Calm Deep</option>
</select>
</div>
<!-- ğŸ”Š Pitch & Rate Sliders -->
<div class="settings-group">
<label for="pitch-slider">ğŸšï¸ Pitch:</label>
<input id="pitch-slider" max="2" min="0.5" step="0.01" type="range" value="1"/>
<span id="pitch-value">1.00</span>
</div>
<div class="settings-group">
<label for="rate-slider">âš¡ Speed:</label>
<input id="rate-slider" max="2" min="0.5" step="0.01" type="range" value="1"/>
<span id="rate-value">1.00</span>
</div>
<!-- ğŸ” Playback Controls -->
<div class="settings-group">
<h3>ğŸ” Playback Options</h3>
<label><input id="loop-toggle" type="checkbox"/> Loop Playback</label><br/>
<label><input id="auto-resume" type="checkbox"/> Auto Resume</label>
</div>
<!-- ğŸŒ Language Preferences -->
<div class="settings-group">
<h3>ğŸŒ Language Preferences</h3>
<label for="lang-read">Read in:</label>
<select id="lang-read">
<option value="en">English</option>
<option value="fr">French</option>
<option value="es">Spanish</option>
<option value="pt">Portuguese</option>
<option value="sw">Swahili</option>
<option value="ar">Arabic</option>
<option value="zh">Chinese</option>
<option value="jp">Japanese</option>
</select>
<label for="lang-translate">Translate to:</label>
<select id="lang-translate">
<option value="none">None</option>
<option value="en">English</option>
<option value="fr">French</option>
<option value="es">Spanish</option>
<option value="pt">Portuguese</option>
<option value="sw">Swahili</option>
<option value="ar">Arabic</option>
<option value="zh">Chinese</option>
<option value="jp">Japanese</option>
</select>
<label><input id="enable-translation" type="checkbox"/> ğŸŒ Enable Translation</label>
</div>
<!-- ğŸ“ˆ Listening Stats -->
<div class="settings-group">
<h3>ğŸ“ˆ Listening Stats</h3>
<p>Total Listening Time: <span id="total-listening">0h 0m</span></p>
<p>Chapters Completed: <span id="chapters-completed">0</span></p>
<p>Favorites: <span id="favorites-count">0</span></p>
</div>
<!-- ğŸ Reward Progress -->
<div class="settings-group">
<h3>ğŸ Reward Settings</h3>
<label><input id="auto-reward-toggle" type="checkbox"/> Enable Streak Rewards</label>
<p>Next Reward at: <span id="next-reward">10 chapters</span></p>
</div>
<!-- ğŸ§© Add-On Features -->
<div class="settings-group">
<h3>ğŸ§© Add-On Features</h3>
<label><input checked="" type="checkbox"/> Translation</label>
<label><input checked="" type="checkbox"/> Capture Mode</label>
<label><input type="checkbox"/> AI Explanation</label>
<label><input type="checkbox"/> Image Description</label>
</div>
<!-- ğŸ’³ Billing Section -->
<div class="settings-group">
<h3>ğŸ’³ Billing &amp; Account</h3>
<button id="manage-subscription">Manage Subscription</button>
<button id="sign-out">Sign Out</button>
</div>
<!-- ğŸ§  Developer Mode -->
<div class="settings-group">
<h3>ğŸ§  Developer Mode</h3>
<label><input id="dev-mode-toggle" type="checkbox"/> Enable Developer Mode</label>
<button onclick="viewLogs()">View Logs</button>
<button onclick="simulateFree()">Simulate Free Mode</button>
<button onclick="simulateTrial()">Simulate Trial</button>
<button onclick="simulatePremium()">Simulate Premium</button>
</div>
</section>
<!-- ğŸ“‹ Right-Click / Long-Press Context Menu -->
<div class="context-menu" id="context-menu">
<ul>
<li id="menu-play">â–¶ï¸ Play</li>
<li id="menu-add">â• Add to Playlist</li>
<li id="menu-fav">â­ Toggle Favorite</li>
<li id="menu-download">â¬‡ï¸ Download</li>
<li id="menu-delete">ğŸ—‘ï¸ Delete</li>
</ul>
</div>
<!-- ğŸŒ TRANSLATION & SUMMARY TOOLS SECTION -->
<section id="translation-tools">
<h2>ğŸŒ Translation &amp; Chapter Summary Tools</h2>
<p class="description">Translate text, auto-detect languages, and summarize chapters with advanced tools. Powered by cloud and local TTS engines.</p>
<!-- ğŸ”  Language Translation -->
<div class="translation-tool" id="language-translation">
<label for="language-input">Text to Translate:</label>
<textarea id="language-input" placeholder="Enter your text here..." rows="4"></textarea>
<label for="target-language">Translate to:</label>
<select id="target-language">
<option value="fr">ğŸ‡«ğŸ‡· French</option>
<option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
<option value="pt">ğŸ‡µğŸ‡¹ Portuguese</option>
<option value="la">ğŸ›ï¸ Latin</option>
<option value="af">ğŸ‡¿ğŸ‡¦ Afrikaans</option>
<option value="ln">ğŸ‡¨ğŸ‡© Lingala</option>
<option value="sw">ğŸ‡°ğŸ‡ª Swahili</option>
<option value="zh">ğŸ‡¨ğŸ‡³ Chinese</option>
<option value="ja">ğŸ‡¯ğŸ‡µ Japanese</option>
<option value="ar">ğŸ‡¸ğŸ‡¦ Arabic</option>
</select>
<button onclick="translateText()">ğŸŒ Translate</button>
<div class="translation-result" id="translation-output">ğŸ” Translated result will appear here.</div>
</div>
<hr class="translation-separator"/>
<!-- ğŸ§  Auto Language Detection and Live Translation -->
<div class="translation-tool" id="auto-translate">
<label for="auto-input">Auto-Detect Language:</label>
<textarea id="auto-input" placeholder="Paste foreign text..." rows="4"></textarea>
<button onclick="autoDetectTranslate()">ğŸ” Detect &amp; Translate</button>
<div class="translation-result" id="auto-translate-output">ğŸŒ Detected language and translation will appear here.</div>
</div>
<hr class="translation-separator"/>
<!-- ğŸ“š Chapter Summary -->
<div class="translation-tool" id="chapter-summary">
<label for="summary-text">Chapter Text:</label>
<textarea id="summary-text" placeholder="Paste full chapter or section here..." rows="5"></textarea>
<button onclick="summarizeChapter()">ğŸ§  Summarize</button>
<div class="translation-result" id="summary-output">ğŸ“„ Summary will be displayed here.</div>
</div>
</section>
</main>
<!-- Modal -->
<div id="preview-modal" style="display:none;">
<span id="modal-close">âœ–</span>
<pre id="modal-text"></pre>
</div>
<!-- Footer -->
<footer>
<p style="text-align:center; margin-top: 30px;">ğŸ’ªğŸ“šğŸ§ = Empowering minds through books and sound</p>
<p style="text-align:center;">Â© 2025 NeurAloud. All rights reserved.</p>
</footer>
<script>
    if ("serviceWorker" in navigator)
      navigator.serviceWorker.register("service-worker.js")
        .then(r => console.log("âœ… Service Worker registered"))
        .catch(console.error);
  </script>
<!-- ğŸ§  Agent Panel (Usable Chat Version) -->
<div id="agent-dock" class="agent-dock-collapsed" onclick="showAgentPanel()">
  <img src="https://cdn-icons-png.flaticon.com/512/4712/4712109.png" alt="Agent" class="agent-avatar-small" />
  <span class="agent-tooltip">Agent</span>
</div>

<div id="agent-panel" class="agent-panel-hidden">
<span onclick="hideAgentPanel()" style="position:absolute; top:6px; right:10px; font-size:16px; cursor:pointer; font-weight:bold;">âœ–</span>
<div class="agent-body">

<div class="agent-top-bar"><div class="agent-avatar-wrapper"><img alt="Agent Avatar" class="agent-avatar" src="https://cdn-icons-png.flaticon.com/512/4712/4712109.png"/></div><div class="agent-controls-wrapper">

</div> 
  <button onclick="startListening()">ğŸ¤ Speak</button>
  <button onclick="playLastResponse()">â–¶ï¸ Play Response</button>
  <label style="font-size: 13px; margin-left: 8px;">
    <input type="checkbox" id="autoplay-response" />
    ğŸ”Š AutoPlay
  </label>
  </div>

    <div id="agent-chat-log" class="agent-chat-log"></div>
    <input id="agent-input" type="text" placeholder="Ask something..." onkeydown="if(event.key==='Enter') sendAgentQuery()"/>
    <button onclick="sendAgentQuery()">Send</button>

  </div>
</div>

<style>
  .agent-dock-collapsed {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .agent-avatar-small {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    transition: transform 0.2s ease;
  }
  .agent-avatar-small:hover {
    transform: scale(1.1);
  }
  .agent-tooltip {
    margin-top: 5px;
    background: #333;
    color: #fff;
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 12px;
    white-space: nowrap;
    opacity: 0.85;
  }
  .agent-panel-hidden {
    display: none;
    position: fixed;
    bottom: 80px;
    right: 20px;
    width: 300px;
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 10px;
    z-index: 9998;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    overflow: hidden;
  }
  .agent-header {
    background: #4a63e7;
    color: white;
    padding: 1px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .agent-body {
    padding: 10px;
    text-align: center;
  }
  .agent-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    margin-bottom: 10px;
  }
  #agent-chat-log {
    text-align: left;
    height: 180px;
    overflow-y: auto;
    border: 1px solid #ccc;
    padding: 5px;
    font-size: 13px;
    margin-bottom: 6px;
    background: #f9f9f9;
  }
  #agent-input {
    width: 80%;
    padding: 4px;
    margin-bottom: 6px;
    font-size: 13px;
  }

.agent-controls {
  margin-top: 8px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
}

.agent-close-top {
  text-align: right;
  margin-top: 5px;
  margin-right: 5px;
}

.agent-top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 4px 0 10px 0;
}
.agent-avatar-wrapper {
  flex: 0 0 auto;
}
.agent-avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
}
.agent-controls-wrapper {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 10px;
}
</style>

<script>
  function showAgentPanel() {
    document.getElementById("agent-panel").style.display = "block";
    document.getElementById("agent-dock").style.display = "none";
  }

  function hideAgentPanel() {
    document.getElementById("agent-panel").style.display = "none";
    document.getElementById("agent-dock").style.display = "flex";
  }

  function sendAgentQuery() {
    const input = document.getElementById("agent-input");
    const log = document.getElementById("agent-chat-log");
    const question = input.value.trim();
    if (!question) return;

    log.innerHTML += `<div><strong>You:</strong> ${question}</div>`;

    const response = getAgentResponse(question);
    lastAgentResponse = response;
    log.innerHTML += `<div><strong>Agent:</strong> ${response}</div>`;
    log.scrollTop = log.scrollHeight;
    input.value = "";
  }

  function getAgentResponse(q) {
    const question = q.toLowerCase();
    if (question.includes("highlight")) return "NeurAloud highlights text sentence-by-sentence during playback, even for PDFs.";
    if (question.includes("tts") || question.includes("voice")) return "We support Google, IBM, ResponsiveVoice, and Local TTS engines.";
    if (question.includes("library")) return "Your Library shows saved files, favorites, and playback queue.";
    if (question.includes("floating") || question.includes("dock")) return "The floating playback panel can be collapsed, dragged, or docked.";
    if (question.includes("hotkey") || question.includes("shortcut")) return "Use Ctrl+Shift+A to toggle the agent panel.";
    if (question.includes("capture")) return "The Capture section allows you to transcribe live speech or audio and save it.";
    if (question.includes("listen")) return "The Listen section plays back uploaded documents using your selected TTS engine.";
    if (question.includes("subscription")) return "The freemium model allows 10 hours of use/month. Upgrade for unlimited access.";
    if (question.includes("avatar")) return "You can change your voice avatar in the Profile settings.";
    if (question.includes("developer")) return "Developer Mode lets you simulate free, trial, and premium environments.";
    return "I'm still learning! Try asking about TTS, highlighting, or capture features.";
  }

  document.addEventListener("keydown", function(e) {
    if (e.ctrlKey && e.shiftKey && e.key === "A") {
      const panel = document.getElementById("agent-panel");
      if (panel.style.display === "none" || panel.classList.contains("agent-panel-hidden")) {
        showAgentPanel();
      } else {
        hideAgentPanel();
      }
    }
  });

  const synth = window.speechSynthesis;
let lastAgentResponse = '';

  function playLastResponse() {
  if (lastAgentResponse) speakResponse(lastAgentResponse);
}

function speakResponse(text) {
    if (!synth) return;
    const utterance = new SpeechSynthesisUtterance(text);
    synth.speak(utterance);
  }

  function startListening() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert("Speech Recognition not supported in this browser.");
      return;
    }

    const recognition = new SpeechRecognition();
    recognition.lang = "en-US";
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.start();

    recognition.onresult = function(event) {
      const transcript = event.results[0][0].transcript;
      document.getElementById("agent-input").value = transcript;
      sendAgentQuery();
    };

    recognition.onerror = function(event) {
      console.error("Speech recognition error:", event.error);
    };
  }

  const originalSendAgentQuery = sendAgentQuery;
  sendAgentQuery = function() {
    const input = document.getElementById("agent-input");
    const log = document.getElementById("agent-chat-log");
    const question = input.value.trim();
    if (!question) return;

    log.innerHTML += `<div><strong>You:</strong> ${question}</div>`;
    const response = getAgentResponse(question);
    lastAgentResponse = response;
    log.innerHTML += `<div><strong>Agent:</strong> ${response}</div>`;
    log.scrollTop = log.scrollHeight;
    input.value = "";

    if (document.getElementById("autoplay-response").checked) {
      speakResponse(response);
    }
  };
</script>



<!-- ğŸ§ Advanced Vertical Floating Panel -->
<button class="floating-button" id="panel-play">â–¶ï¸</button>
  <hr/>
  <button class="floating-button" title="Capture" onclick="navigate('capture')">ğŸ“¸</button>
  <button class="floating-button" title="Bookmark" onclick="alert('Bookmark saved!')">ğŸ”–</button>
</div>

<style>
  .vertical-panel {
    position: fixed;
    top: 40%;
    right: 10px;
    width: 60px;
    background-color: #1e1e1e;
    border-radius: 30px;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0;
    transition: width 0.3s ease, height 0.3s ease;
    color: white;
  }

  .vertical-panel.expanded {
    width: 220px;
    height: auto;
    padding: 12px;
  }

  .floating-timer {
    font-size: 16px;
    margin-bottom: 10px;
  }

  .floating-button {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    margin: 8px 0;
    cursor: pointer;
  }

  .floating-button:hover {
    color: #8faaff;
  }

  .vertical-panel hr {
    width: 40%;
    border: 0.5px solid #444;
  }
</style>

<script>
  function expandFloatingPanel() {
    const panel = document.getElementById("floating-panel");
    panel.classList.toggle("expanded");
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById('floating-panel').classList.add('collapsed');
  });
</script>


<!-- ğŸ§ Fully Enhanced Vertical Floating Panel -->
<button class="floating-button" onclick="document.getElementById('play-btn').click()">â–¶ï¸</button>
  <hr/>
  <button class="floating-button" title="Capture" onclick="navigate('capture')">ğŸ“¸</button>
  <button class="floating-button" title="Bookmark" onclick="alert('Bookmark saved!')">ğŸ”–</button>
</div>

<!-- ğŸ”˜ Minimized Panel -->
<div id="floating-minimized" class="floating-minimized" onclick="restoreFloatingPanel()" title="Undock">
  ğŸ§
</div>

<style>
  .vertical-panel {
    position: fixed;
    top: 40%;
    right: 10px;
    width: 60px;
    background-color: #1e1e1e;
    border-radius: 30px;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0;
    transition: width 0.3s ease, height 0.3s ease;
    color: white;
  }

  .vertical-panel.expanded {
    width: 220px;
    padding: 12px;
  }

  .floating-header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 10px;
    align-items: center;
    margin-bottom: 10px;
  }

  .floating-timer {
    font-size: 16px;
  }

  .floating-minimize {
    font-size: 18px;
    cursor: pointer;
    color: white;
  }

  .floating-button {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    margin: 8px 0;
    cursor: pointer;
  }

  .floating-button:hover {
    color: #8faaff;
  }

  .vertical-panel hr {
    width: 40%;
    border: 0.5px solid #444;
  }

  .floating-minimized {
    display: none;
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 60px;
    height: 40px;
    background-color: #333;
    border-radius: 20px;
    text-align: center;
    line-height: 40px;
    font-size: 20px;
    color: white;
    box-shadow: 0 0 8px rgba(0,0,0,0.2);
    cursor: pointer;
    z-index: 9998;
    transition: transform 0.3s ease;
  }

  .floating-minimized:hover::after {
    content: "Undock";
    position: absolute;
    top: -28px;
    right: 0;
    background: #444;
    color: white;
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 6px;
  }
</style>

<script>
  function minimizeFloatingPanel() {
    document.getElementById("floating-panel").style.display = "none";
    document.getElementById("floating-minimized").style.display = "block";
  }

  function restoreFloatingPanel() {
    document.getElementById("floating-panel").style.display = "flex";
    document.getElementById("floating-minimized").style.display = "none";
  }

  function hoverDock(show) {
    const minimized = document.getElementById("floating-minimized");
    minimized.title = show ? "Undock" : "";
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById('floating-panel').style.display = 'flex';
    document.getElementById('floating-minimized').style.display = 'none';
  });
</script>


<!-- ğŸ§ Unified Floating Playback Station -->
<div id="floating-station" class="station-mode-normal" onmouseenter="hoverDock(true)" onmouseleave="hoverDock(false)">
  <div class="station-header">
    <span id="station-timer">4:12</span>
    <span class="station-close" onclick="toggleStationMode()">âœ–</span>
  </div>
  <div class="station-controls">
    <button onclick="document.getElementById('play-btn').click()">â–¶ï¸</button>
    <button onclick="navigate('capture')" title="Capture">ğŸ“¸</button>
    <button onclick="alert('Bookmark saved!')" title="Bookmark">ğŸ”–</button>
  </div>
</div>

<style>
  /* ğŸ› Base Styling */
  #floating-station {
    position: fixed;
    right: 16px;
    z-index: 9999;
    background: #1e1e1e;
    color: white;
    font-family: Arial, sans-serif;
    transition: all 0.3s ease;
  }

  .station-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 12px;
  }

  #station-timer {
    font-size: 14px;
  }

  .station-close {
    font-size: 16px;
    cursor: pointer;
  }

  .station-controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-bottom: 8px;
    gap: 10px;
  }

  .station-controls button {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .station-controls button:hover {
    transform: scale(1.15);
    color: #8faaff;
  }

  /* ğŸ§Š Normal Mode */
  .station-mode-normal {
    top: 40%;
    width: 60px;
    border-radius: 30px;
    text-align: center;
    padding: 8px 0;
    height: auto;
  }

  /* ğŸ§© Expanded Mode */
  .station-mode-expanded {
    top: 30%;
    width: 220px;
    border-radius: 20px;
    padding: 10px 0;
  }

  /* ğŸª¶ Minimized Mode */
  .station-mode-minimized {
    bottom: 90px;
    width: 60px;
    height: 40px;
    border-radius: 20px;
    text-align: center;
    line-height: 40px;
    font-size: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .station-mode-minimized:hover::after {
    content: "Undock";
    position: absolute;
    top: -28px;
    background: #444;
    color: white;
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 6px;
  }
</style>

<script>
  let stationState = "normal"; // "normal", "expanded", or "minimized"

  function toggleStationMode() {
    const station = document.getElementById("floating-station");

    if (stationState === "normal") {
      station.className = "station-mode-expanded";
      stationState = "expanded";
    } else if (stationState === "expanded") {
      station.className = "station-mode-minimized";
      stationState = "minimized";
    } else {
      station.className = "station-mode-normal";
      stationState = "normal";
    }
  }

  function hoverDock(show) {
    const station = document.getElementById("floating-station");
    if (stationState === "minimized") {
      station.title = show ? "Undock" : "";
    } else {
      station.title = "";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("floating-station").className = "station-mode-normal";
  });
</script>


<!-- ğŸ§ Cleaned Unified Floating Station -->
<div id="floating-station" class="station-mode-normal">
  <div class="station-header">
    <span id="station-timer">4:12</span>
    <div>
      <button class="station-icon" onclick="dockStation()" title="Dock">ğŸ§²</button>
      <button class="station-icon" onclick="expandStation()" title="Expand">ğŸ”</button>
    </div>
  </div>
  <div class="station-controls">
    <button onclick="document.getElementById('play-btn').click()">â–¶ï¸</button>
    <button onclick="navigate('capture')" title="Capture">ğŸ“¸</button>
    <button onclick="alert('Bookmark saved!')" title="Bookmark">ğŸ”–</button>
  </div>
</div>

<style>
  /* ğŸ“¦ Station Container */
  #floating-station {
    position: fixed;
    right: 16px;
    z-index: 9999;
    background: #1e1e1e;
    color: white;
    font-family: Arial, sans-serif;
    transition: all 0.3s ease;
    overflow: hidden;
  }

  /* Header */
  .station-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 12px;
  }

  #station-timer {
    font-size: 14px;
  }

  .station-icon {
    background: none;
    border: none;
    color: white;
    font-size: 16px;
    cursor: pointer;
    margin-left: 6px;
  }

  /* Controls */
  .station-controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px 0;
    gap: 10px;
  }

  .station-controls button {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .station-controls button:hover {
    transform: scale(1.15);
    color: #8faaff;
  }

  /* Normal mode */
  .station-mode-normal {
    top: 40%;
    width: 60px;
    border-radius: 30px;
    text-align: center;
    padding: 8px 0;
  }

  /* Expanded mode */
  .station-mode-expanded {
    top: 30%;
    width: 220px;
    border-radius: 20px;
    padding: 10px 0;
  }

  /* Docked/minimized */
  .station-mode-docked {
    top: auto !important;
    bottom: 108px;
    right: 20px;
    width: 60px;
    height: 40px;
    border-radius: 20px;
    text-align: center;
    line-height: 40px;
    font-size: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .station-mode-docked:hover::after {
    content: "Undock";
    position: absolute;
    top: -28px;
    background: #444;
    color: white;
    font-size: 11px;
    padding: 2px 6px;
    border-radius: 6px;
  }
</style>

<script>
  function expandStation() {
    const station = document.getElementById("floating-station");
    station.className = "station-mode-expanded";
    station.innerHTML = `
      <div class="station-header">
        <span id="station-timer">4:12</span>
        <button class="station-icon" onclick="restoreToNormal()" title="Close">âœ–</button>
      </div>
      <div class="station-controls">
        <button onclick="document.getElementById('play-btn').click()">â–¶ï¸</button>
        <button onclick="navigate('capture')" title="Capture">ğŸ“¸</button>
        <button onclick="alert('Bookmark saved!')" title="Bookmark">ğŸ”–</button>
      </div>`;
  }

  function restoreToNormal() {
    const station = document.getElementById("floating-station");
    station.className = "station-mode-normal";
    station.innerHTML = `
      <div class="station-header">
        <span id="station-timer">4:12</span>
        <div>
          <button class="station-icon" onclick="dockStation()" title="Dock">ğŸ§²</button>
          <button class="station-icon" onclick="expandStation()" title="Expand">ğŸ”</button>
        </div>
      </div>
      <div class="station-controls">
        <button onclick="document.getElementById('play-btn').click()">â–¶ï¸</button>
        <button onclick="navigate('capture')" title="Capture">ğŸ“¸</button>
        <button onclick="alert('Bookmark saved!')" title="Bookmark">ğŸ”–</button>
      </div>`;
  }

  function dockStation() {
    const station = document.getElementById("floating-station");
    station.className = "station-mode-docked";
    station.innerHTML = `ğŸ§`;
    station.title = "Undock";
    station.onclick = () => restoreToNormal();
  }

  document.addEventListener("DOMContentLoaded", () => {
    restoreToNormal();
  });
</script>
<!-- Script -->
<!-- <script src="script_final_enhanced.js"></script> -->
<script src="script.js"></script>
</body>
</html>